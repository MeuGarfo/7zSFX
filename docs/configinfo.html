<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Информация о файле конфигурации</TITLE>
<META http-equiv=Content-Type content="text/html; charset=Windows-1251">
<LINK href="misc/styles.css" type="text/css" rel=stylesheet>
</HEAD>
<BODY>

<H2>Общая информация о файле конфигурации</H2>
<P>Данный SFX модуль сохраняет все свойства стандартного SFX модуля архиватора 7-Zip и добавляет возможности, перечисленные в этой документации.</P>
<UL>
	<LI>Файл конфигурации <B>ДОЛЖЕН БЫТЬ</B> сохранен в кодировке <B>UTF-8</B>.
	<LI>Существуют 4 типа команд запуска программ: '<tt>AutoInstall</tt>', '<tt>AutoInstallX</tt>', '<tt>RunProgram</tt>' и '<tt>ExecuteFile</tt>'. В файле конфигурации могут одновременно присутствовать любые из этих 4-х типов и даже все, но после запуска SFX архива может выполняться только один тип команд запуска.
	<LI>Параметры '<tt>AutoInstall</tt>', '<tt>AutoInstallX</tt>', '<tt>RunProgram</tt>', '<tt>Delete</tt>', '<tt>DeleteX</tt>', '<tt>SetEnvironment</tt>', '<tt>Shortcut</tt>' и '<tt>ShortcutX</tt>' - множественные, т.е. могут присутствовать в файле конфигурации неограниченное количество раз. Указанные параметры, если их несколько в пределах своего типа, обрабатываются в той последовательности, в которой идут в файле конфигурации.
	<LI>Команд запуска программ в каждом типе ('<tt>AutoInstall</tt>', '<tt>AutoInstallX</tt>' и '<tt>RunProgram</tt>') может быть несколько, обрабатываются они (в пределах каждого типа) в той последовательности, в которой указаны в файле конфигурации, при этом ожидается окончание предыдущей команды, а после этого запускается следующая.
	<LI><tt>'AutoInstall</tt>' запускается нажатием кнопки "Да/OK" в окне '<tt>BeginPrompt</tt>', с нажатой кнопкой [Shift], или из командной строки. '<tt>AutoInstallX</tt>' запускается только из командной строки. '<tt>ExecuteFile</tt>' и '<tt>RunProgram</tt>' запускается только из файла конфигурации.<br>
	Одновременное наличие '<tt>ExecuteFile</tt>' и '<tt>RunProgram</tt>', в файле конфигурации, возможно, но нецелесообразно, т.к. '<tt>ExecuteFile</tt>' имеет приоритет и все '<tt>RunProgram</tt>' будут проигнорированы. Однако '<tt>RunProgram</tt>' множественные, не требуют дополнительных параметров для ввода ключей, и поэтому предпочтительнее.
	<LI>Для '<tt>ExecuteFile</tt>', если нужно указать ключи, применяется '<tt>ExecuteParameters</tt>'. Если ключей нет, то '<tt>ExecuteParameters</tt>' может отсутствовать.
	<LI>Для '<tt>RunProgram</tt>', если нужно указать путь к исполняемому файлу, может применяться '<tt>Directory</tt>'. Путь к исполняемому файлу может быть указан непосредственно в '<tt>RunProgram</tt>'. Параметр '<tt>Directory</tt>' может быть только один и используется только для первого '<tt>RunProgram</tt>', но не обязателен и может отсутствовать совсем.
	<LI>Взаимное расположение параметров '<tt>ExecuteFile</tt>' и '<tt>ExecuteParameters</tt>', а также '<tt>RunProgram</tt>' и '<tt>Directory</tt>' значения не имеет.
	<LI>Алгоритм выбора типа команд запуска следующий: если указано использование '<tt>AutoInstall</tt>' ([Shift], командная строка) или '<tt>AutoInstallX</tt>' (командная строка) - используется они. Если нет - проверяется наличие '<tt>ExecuteFile</tt>' и, если есть, то используется он (все '<tt>RunProgram</tt>' при этом игнорируются). Если и '<tt>ExecuteFile</tt>' нет - проверяется '<tt>RunProgram</tt>'.
	<LI>Работают файловые ассоциации, т.е. можно указывать RunProgram="Setup.msi", не используя при этом StartX.exe, msistub.exe и подобные утилиты.
	<LI>Если '<tt>RunProgram</tt>', '<tt>ExecuteFile</tt>', '<tt>AutoInstall</tt>' или '<tt>AutoInstallX</tt>' отсутствуют, и распаковка происходит во временную папку ('<tt>InstallPath</tt>' отсутствует), будет сделана попытка выполнить файл "setup.exe" (если он имеется в корне архива). "'<tt>InstallPath</tt>' отсутствует" означает - либо отсутствие параметра '<tt>InstallPath</tt>' в файле конфигурации, либо InstallPath="", либо стирание пути, в соответствующем поле редактирования, после запуска архива. Если путь распаковки указан - попытки выполнить "setup.exe" не будет.
	<LI>Исполняемый после распаковки файл не обязательно должен располагаться в корне архива. Последовательность поиска: сначала в папке распаковки, затем по путям, указанным в %PATH%.
	<LI>Параметры '<tt>AutoInstall</tt>', '<tt>Delete</tt>', '<tt>Shortcut</tt>' могут быть простые или литерные '<tt>AutoInstallX</tt>', '<tt>DeleteX</tt>', '<tt>ShortcutX</tt>', где X - литера варианта соответствующей автоматической установки. В качестве X допустимы [0...9], [A...Z], [a...z] (только один символ).
</UL>
<HR align=left width="100%">
<P id="slash"><b>ВАЖНО!</b> Следующие двухсимвольные последовательности в "значение_параметра" заменяются односимвольными:</P>
<UL>
	<LI>\\ = \
	<LI>\" = "
	<LI>\n = перевод строки
	<LI>\t = табуляция
</UL>
<P>Если надо указать обратный слеш (<B>\</B>) (например, в путях или тексте диалога), <b>НЕОБХОДИМО</b> использовать <B>ДВОЙНОЙ</B> (<B>\\</B>), а если "значение_параметра" или текст диалога содержит кавычки (<b>"</b>), <b>НЕОБХОДИМО</b> перед ними использовать обратный слеш (<B>\"</B>) (правило "лидирующего слеша").</P>
<P>Двухсимвольные последовательности \n и \t зависят от регистра. Т.е., \N и \T НЕ будут заменяются односимвольными.</P>
<HR align=left width="100%">
<P id="paths">Модуль также поддерживает <b>относительные</b> пути в следующих параметрах и ключах:</P>
<ul>
	<LI>'<tt>AutoInstall</tt>', '<tt>AutoInstallX</tt>', '<tt>Directory</tt>', '<tt>ExecuteFile</tt>', '<tt>RunProgram</tt>' - относительно папки, в которую произведена распаковка
	<LI>'<tt>ExecuteOnLoad</tt>', '<tt>PreExtract</tt>', '<tt>PreExtractX</tt>' - относительно временной папки создаваемой модулем, путь к папке находится в переменной %SfxVarApiPath%
	<LI>'<tt>InstallPath</tt>', '<tt>-sfxconfig</tt>' - относительно папки программы, из которой произведен запуск SFX архива<br>
	<b>ВНИМАНИЕ!</b> Это не обязательно папка, в которой расположен SFX архив. Если SFX архив запущен из <b>другой</b> программы (.bat, .cmd, и т.д.), то текущей будет папка этой программы.
	<LI>'<tt>Delete</tt>', '<tt>DeleteX</tt>' - относительно папки, в которой расположен SFX архив
</ul>
<HR align=left width="100%">
<P>Для '<tt>RunProgram</tt>' и всех вариантов '<tt>AutoInstall</tt>'-ов <b>МОЖНО/НУЖНО</b> заключать <b>путь и имя исполняемой программы</b> в дополнительные кавычки.<br>
<b>МОЖНО</b>, даже если имя и путь к исполняемому файлу НЕ СОДЕРЖАТ пробелов, <b>НУЖНО</b>, если СОДЕРЖАТ пробелы, т.к. имя и путь к исполняемому файлу формируются ПОСЛЕ разбора переменных среды. Например:</P>
<pre class="pre40">RunProgram="nowait:%ProgramFiles%\\test.exe /s"</pre>
<P>В НАПИСАНИИ имя и путь к исполняемому файлу не содержит пробелов, но после подстановки оно МОЖЕТ содержать пробелы. Поэтому лучше всегда писать так:</P>
<pre class="pre40">RunProgram="nowait:<b>\"</b>%ProgramFiles%\\test.exe<b>\"</b> /s"</pre>
<p>Префиксы и ключи исполняемой программы в дополнительные кавычки <b>НЕ ВКЛЮЧАЮТСЯ</b>.</P>
<P>Для '<tt>ExecuteFile</tt>' <b>необязательны</b> дополнительные кавычки даже для имен с пробелами (т.к. в нем не может быть ключей командной строки). Т.е. предыдущий пример может быть записан так:</P>
<pre class="pre40">ExecuteFile="nowait:%ProgramFiles%\\test.exe"
ExecuteParameters="/s"</pre>
<HR align=left width="100%">
<P>Многострочный текст допустим в диалогах следующих параметров:</P>
<UL>
	<LI>'<tt>BeginPrompt</tt>'
	<LI>'<tt>CancelPrompt</tt>'
	<LI>'<tt>ExtractDialogText</tt>'
	<LI>'<tt>ExtractPathText</tt>'
	<LI>'<tt>FinishMessage</tt>'
	<LI>'<tt>HelpText</tt>'
</UL>
<P>В тексте допустимы любые символы. Слеши (\) и кавычки (") попадают под правило "лидирующего слеша" (см. <A href="#slash" class="int">выше</A>), т.е. написав<br>
&nbsp;</P>
<div align=center>
<pre class="example_code" style="WIDTH: 98%; HEIGHT: 38px;">HelpText="Так пишите (в скобках \"и кавычках\")\nА так пишите путь C:\\Windows\nА вот так используйте табуляцию\nПоз. 1\tПоз. 2\tПоз. 3\tПоз. 4"</pre>
</div>
<p>получим следующее диалоговое окно:</p>
<P align="center"><IMG alt="help" src="misc/Text.png"></P>
<P>Размеры окна диалога зависят от длины строк и их количества, и будут автоматически изменяться.</P>
<HR align=left width="100%">
<p>Прервать работу SFX архива можно:</p>
<ul>
	<li>Нажатием кнопки "Нет" или "Отмена" в тех диалогах, где они предусмотрены
	<li>Нажатием кнопки "Закрыть" (которая в правом верхнем углу окна) за исключением диалога распаковки, если кнопка блокирована параметром '<tt>GUIMode</tt>' или ключом '<tt>-gmX</tt>' равным 1
	<li>Нажатием кнопки '<tt>ExtractCancelText</tt>' в диалоге распаковки, если она не скрыта параметром '<tt>GUIMode</tt>'	или ключом '<tt>-gmX</tt>' равным 1
	<li>Нажатием клавиши [Esc] на клавиатуре (если параметр '<tt>GUIMode</tt>' или ключ '<tt>-gmX</tt>' равен 1, то в диалоге распаковки не действует)
</ul>
<p>При указанных выше действиях будет выведен диалог подтверждения отмены распаковки/установки, если он разрешен флагом 256 параметра '<tt>GUIFlags</tt>'. Текст диалога отмены можно назначить параметром '<tt>CancelPrompt</tt>'. Этот диалог НЕ будет выводиться в окне сообщения об ошибке и в окнах определяемых параметрами '<tt>FinishMessage</tt>' и '<tt>HelpText</tt>'.</p>
<p>&nbsp;</p>
</BODY></HTML>