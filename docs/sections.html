<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Секции файла конфигурации</TITLE>
<META http-equiv=Content-Type content="text/html; charset=Windows-1251">
<LINK href="misc/styles.css" type="text/css" rel=stylesheet>
</HEAD>
<BODY>

<H2>Секции файла конфигурации</H2>

<p>Файл конфигурации может состоять из нескольких секций. Сейчас существуют четыре типа секций:</p>
<UL>
	<li><b>Основная</b>
	<li><b>Платформенные</b>
	<li><b>Языковые</b>
	<li><b>Платформенно-языковые</b>
</UL>
<p><b>Основная</b> секция - без суффиксов (только одна). <i>Оригинальная для SFX модуля архиватора 7-Zip.</i> Запись:</p>
<pre class="pre40">;!@Install@!UTF-8!
RunProgram="setup.exe"
;!@InstallEnd@!</pre>
<p><b>Платформенные</b> секции определяются суффиксами (только два вида):</p>
<UL>
	<li><b>x86</b> (i386) - для 32-битной операционной системы
	<li><b>x64</b> (amd64) - для 64-битной операционной системы
</UL>
<p>В скобках указаны допустимые замены. Варианты записи:</p>
<pre class="pre40">;!@Install@!UTF-8:x86!
RunProgram="setup_86.exe"
;!@InstallEnd@:x86!

;!@Install@!UTF-8:x64!
RunProgram="setup_64.exe"
;!@InstallEnd@:x64!

;!@Install@!UTF-8:amd64!
RunProgram="setup_64.exe"
;!@InstallEnd@:amd64!</pre>
<p><b>Языковые</b> секции определяются суффиксами (множество видов):</p>
<UL>
	<li><b>Language:XXXX<br>
	</b>где <b>XXXX</b> - ID языка интерфейса пользователя<br>
&nbsp;<li><b>Language:1049</b> - для русского интерфейса<li><b>Language:1033</b> - для английского интерфейса<li><b>Language:1058</b> - для украинского интерфейса
</UL>
<p>Варианты записи:</p>
<pre class="pre40">;!@Install@!UTF-8:Language:1049!
RunProgram="setup_ru.exe"
;!@InstallEnd@:Language:1049!

;!@Install@!UTF-8:Language:1033!
RunProgram="setup_en.exe"
;!@InstallEnd@:Language:1033!</pre>


<p><b>Платформенно-языковые</b> секции определяются составными суффиксами состоящими из суффикса платформы и суффикса языка. Последовательность суффиксов важна, первым должен идти суффикс платформы, а затем языка. Варианты записи:</p>
<pre class="pre40">;!@Install@!UTF-8:x86:Language:1049!
RunProgram="setup_86_ru.exe"
;!@InstallEnd@:x86:Language:1049!

;!@Install@!UTF-8:x64:Language:1033!
RunProgram="setup_64_en.exe"
;!@InstallEnd@:x64:Language:1033!

;!@Install@!UTF-8:amd64:Language:1058!
RunProgram="setup_64.exe"
;!@InstallEnd@:amd64:Language:1058!</pre>


<p><font color="#990000"><b>Последовательность загрузки секций и обработка их модулем</b></font></p>
<p>&nbsp;</p>
<p>После запуска SXF архива начинается формирование рабочего файла конфигурации. Рабочий - это тот, который и будет выполнен при данном конкретном запуске с учетом языка и разрядности системы.</p>
<p>Расположение секций в файле конфигурации значения не имеет, важна последовательность загрузки секций в рабочий файл конфигурации.</p>
<p>Секции загружаются в рабочий файл конфигурации в следующей последовательности:</p>
<ul>
	<li><b>Основная</b> секция (без суффиксов). <i>Оригинальная для SFX модуля архиватора 7-Zip.</i>
	<li><b>Платформенная</b> секция
	<li><b>Языковая</b> секция
	<li><b>Платформенно-языковая</b> секция
</ul>
<p>Загрузка происходит так:</p>
<p>1. Сначала в рабочий файл конфигурации загружается <b>основная</b> секция.</p>
<p>2. Определяется платформа (разрядность) системы на которой запущен SFX архив и ищется соответствующая <b>платформенная</b> секция. Если найдена, ПОДГРУЖАЕТСЯ к рабочему файлу конфигурации.</p>
<p>3. Определяется язык интерфейса пользователя системы, на которой запущен SFX архив и ищется <b>языковая </b> секция. Если найдена, ПОДГРУЖАЕТСЯ к рабочему файлу конфигурации.</p>
<p>4. Ищется <b>платформенно-языковая </b> секция, соответствующая ранее определенным платформе и языку интерфейса пользователя системы на которой запущен SFX архив. Если найдена, ПОДГРУЖАЕТСЯ к рабочему файлу конфигурации.</p>
<p>После завершения загрузки секций, созданный рабочий файл конфигурации обрабатывается. </p>
<p>Параметры обрабатываются (переопределяются/добавляются) в том порядке, в котором они были загружены и в котором они стояли в секциях.</p>
<p>Если параметр НЕ множественный, то используется последнее значение. Например, если '<tt>Title</tt>' указан во всех четырех вариантах, будет использован тот, который определен в <b>платформенно-языковой </b> секции.</p>
<p>Если параметр множественный, то он просто добавляется в список.</p>
<p>Если необходимо ПОЛНОСТЬЮ переопределить какой-то множественный параметр, можно обнулить список этого параметра (т.е. удалить все предыдущие), указав в нем знак, минус (<font color="#990000"><b>-</b></font>), например:</p>
<pre class="pre40">RunProgram=-</pre>
<p>&nbsp;</p>
<p><font color="#990000"><b>Примеры использования</b></font></p>
<p>&nbsp;</p>
<p>Файл конфигурации с <b>основной</b> и <b>языковой</b> секцией. Для удобства файл снабжен комментариями и разбит на группы (указаны в квадратных скобках). </p>
<pre class="pre40">; Основная секция
;!@Install@!UTF-8!
; [1] Переменные, не зависящие от языка интерфейса пользователя
SetEnvironment="Name=Universal Extractor"
SetEnvironment="Vers= v1.6.1.43"
SetEnvironment="PathInst=%ProgramFiles%\\%Name%"
; [2] Переменные, зависящие от языка интерфейса пользователя
SetEnvironment="NameInf=UExtr_en.inf"
; [3] Не множественные параметры, не зависящие от языка интерфейса пользователя
InstallPath="%PathInst%"
BeginPromptTimeout="20"
GUIFlags="2+4+8+16+32+2048+4096"
GUIMode="1"
MiscFlags="4"
; [4] Не множественные параметры, зависящие от языка интерфейса пользователя
Title="%Name% Setup"
BeginPrompt="Installing %Name%%Vers%"
FinishMessage="%Name%%Vers% Installed!"
ExtractTitle="Extracting files ..."
ExtractDialogText="Please wait ..."
HelpText="Switches for 'silent' install:

> %%M -y -gm2 -fm0

See details on a site: http://7zsfx.info/"
; [5] Множественные параметры, зависящие от языка интерфейса пользователя
RunProgram="fm20:hidcon:cmd /c Move %NameInf% %WINDIR%\\INF"
RunProgram="rundll32 advpack,LaunchINFSection %NameInf%,DefaultInstall,0"
RunProgram="hidcon:cmd /c Echo language=English>>UniExtract.ini"
; [6] Множественные параметры, не зависящие от языка интерфейса пользователя
Delete="%%T\\UExtr_en.inf"
Delete="%%T\\UExtr_ru.inf"
;!@InstallEnd@!
; =======================================================================
; Языковая секция (русская)
;!@Install@!UTF-8:Language:1049!
; [7] Переменные, зависящие от языка интерфейса пользователя
SetEnvironment="NameInf=UExtr_ru.inf"
; [8] Не множественные параметры, зависящие от языка интерфейса пользователя
Title="Установка %Name%"
BeginPrompt="Сейчас будет установлен
%Name%%Vers%"
FinishMessage="%Name%%Vers% установлен!"
ExtractTitle="Распаковка файлов..."
ExtractDialogText="Придется подождать..."
HelpText="Ключи для 'тихой' установки:

> %%M -y -gm2 -fm0

Подробнее на сайте: http://7zsfx.info/"
; [9] Множественные параметры, зависящие от языка интерфейса пользователя
RunProgram=-
RunProgram="fm20:hidcon:cmd /c Move %NameInf% %WINDIR%\\INF"
RunProgram="rundll32 advpack,LaunchINFSection %NameInf%,DefaultInstall,0"
RunProgram="hidcon:cmd /c Echo language=Russian>>UniExtract.ini"
;!@InstallEnd@:Language:1049!</pre>
<p>Группа [1] содержит переменные, которые НЕ зависят от языка интерфейса пользователя и будут существовать при запуске SFX на любой системе.</p>
<p>Группа [2] содержит переменную <b>NameInf</b>, которая зависит от языка интерфейса пользователя. При запуске SFX на любой НЕ русской системе будет использована эта группа, но на русской операционной системе переменная <b>NameInf</b> будет взята из группы [7] (будет переопределена).</p>
<p>Группа [3] содержит не множественные параметры, которые НЕ зависят от языка интерфейса пользователя и будут существовать при запуске SFX на любой системе.</p>
<p>Группа [4] содержит не множественные параметры, которые зависят от языка интерфейса пользователя. При запуске SFX на любой НЕ русской системе будет использована эта группа, но на русской операционной системе все эти параметры будет взяты из группы [8] (будут переопределены).</p>
<p>Группа [5] содержит множественные параметры, которые зависят от языка интерфейса пользователя. Первые два параметра '<tt>RunProgram</tt>' имеют идентичные значения в группе [9], но последние '<tt>RunProgram</tt>' в этих группах различны. Невозможно заменить только один параметр '<tt>RunProgram</tt>' на другой и для этого в группе [9] используется строка <b>RunProgram=-</b>. Она идет первой в группе и отменяет все предыдущие параметры '<tt>RunProgram</tt>' в файле конфигурации (в нашем случае всю группу [5]). При запуске SFX на любой НЕ русской системе будет использована группа [5], но на русской операционной системе все параметры из этой группы будет проигнорированы и взяты из группы [9].</p>
<p>Группа [6] содержит множественные параметры, которые НЕ зависят от языка интерфейса пользователя и будут существовать при запуске SFX на любой системе.</p>
<p>&nbsp;</p>
<p>Файл конфигурации с <b>основной</b> и <b>платформенной</b> секцией. Для удобства файл снабжен комментариями и разбит на группы (указаны в квадратных скобках). </p>
<pre class="pre40">; Основная секция
;!@Install@!UTF-8!
; [1] Переменные, не зависящие от платформы системы
SetEnvironment="Name=Archiver"
SetEnvironment="nVer=40b2"
SetEnvironment="Vers= v4.0.2 beta ru [x86\x64]"
SetEnvironment="NameTheme=W7Elegant_48x48"
; [2] Переменные, зависящие от платформы системы
SetEnvironment="PFx86=%ProgramFiles%\\Archiver"
; [3] Не множественные параметры, не зависящие от платформы системы
Title="Установка %Name%"
BeginPrompt="Сейчас будет установлен
%Name%%Vers%"
FinishMessage="%Name%%Vers% установлен!"
GUIFlags="2+4+8+16+32+2048+4096"
GUIMode="1"
MiscFlags="4"
ExtractTitle="Распаковка файлов..."
ExtractDialogText="Придется подождать..."
; [4] Множественные параметры, зависящие от платформы системы
RunProgram="hidcon:ThemeDef.cmd"
RunProgram="fm20:hidcon:cmd /c If Exist Arch.key Copy /y Arch.key Archiver-x86-%nVer%\\Arch.key"
RunProgram="hidcon:xcopy Archiver-x86-%nVer%\\* \"%PFx86%\\\" /s /e /i /y"
RunProgram="hidcon:cmd /c Move Archiverx86.inf %WINDIR%\\INF"
RunProgram="rundll32 advpack,LaunchINFSection Archiverx86.inf,DefaultInstall,0"
RunProgram="hidcon:cmd /c If Exist \"%%S\\Archiver40.reg\" REGEDIT /S \"%%S\\Archiver40.reg\""
;!@InstallEnd@!
; =======================================================================
; Платформенная секция (x64)
;!@Install@!UTF-8:x64!
; [5] Переменные, зависящие от платформы системы
SetEnvironment="PFx64=%ProgramW6432%\\Archiver"
; [6] Множественные параметры, зависящие от платформы системы
RunProgram=-
RunProgram="hidcon:ThemeDef.cmd"
RunProgram="fm20:hidcon:cmd /c If Exist Arch.key Copy /y Arch.key Archiver-x64-%nVer%\\Arch.key"
RunProgram="hidcon:xcopy Archiver-x64-%nVer%\\* \"%PFx64%\\\" /s /e /i /y"
RunProgram="hidcon:cmd /c Move Archiverx64.inf %WINDIR%\\INF"
RunProgram="rundll32 advpack,LaunchINFSection Archiverx64.inf,DefaultInstall,0"
RunProgram="hidcon:cmd /c If Exist \"%%S\\Archiver40.reg\" REGEDIT /S \"%%S\\Archiver40.reg\""
;!@InstallEnd@:x64!</pre>
<p>Группа [1] содержит переменные, которые НЕ зависят от платформы операционной системы и будут существовать при запуске SFX на любой системе.</p>
<p>Группа [2] содержит переменную <b>PFx86</b>, которая зависит от платформы операционной системы. При запуске SFX на системе с любой платформой будет использована эта группа, но на <b>x64</b> операционной системе переменная <b>PFx86</b> использоваться не будет, а будет использоваться переменная <b>PFx64</b> из группы [5].</p>
<p>Группа [3] содержит не множественные параметры, которые НЕ зависят от платформы операционной системы и будут существовать при запуске SFX на любой системе.</p>
<p>Группа [4] содержит множественные параметры, которые зависят от платформы операционной системы. Некоторые параметры '<tt>RunProgram</tt>' имеют идентичные значения в группе [6], но большинство '<tt>RunProgram</tt>' в этих группах различны. Невозможно заменить только отдельные параметры '<tt>RunProgram</tt>' на другие и для этого в группе [6] используется строка <b>RunProgram=-</b>. Она идет первой в группе и отменяет все предыдущие параметры '<tt>RunProgram</tt>' в файле конфигурации (в нашем случае всю группу [4]). При запуске SFX на <b>x86</b> операционной системе будет использована группа [4], но на <b>x64</b> операционной системе все параметры из этой группы будет проигнорированы и взяты из группы [6].</p>
<p>&nbsp;</p>
</BODY></HTML>